{% extends "gameplayer.html" %}
{% block custom %}
    html{
    height: 100%;
    -moz-user-select: none;
    -khtml-user-select: none;
    user-select: none;
    }

    p{
    color: black;
    font-family: "microsoft yahei";
    font-weight: bold;
    left: -10px;

    }

    body{
    -moz-user-select: none;
    -khtml-user-select: none;
    user-select: none;
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: "microsoft yahei";
    background-color: white ;
    overflow: hidden;
    }
    .container{
    margin:auto;
    width: 452px;
    height: 100%;
    overflow: hidden;
    position: relative;
    }

    .logo{
    width:40%;
    font-size: 70px;
    font-weight: bold;
    color: #d13100;
    float: left;
    position: relative;
    }
    .scoreBar{
    width: 50%;
    float:right;
    background: #fff;
    color: #111;

    padding:10px;
    position: relative;
    margin-top:10px;
    }
    .scoreBar:before{
    content: "";
    display: block;
    border-width: 20px;
    border-color: transparent #fff transparent transparent ;
    border-style: solid;
    position: absolute;
    top:50%;
    left:-40px;
    margin-top:-20px;
    }
    #score{
    font-size: 50px;
    }

    #addScore{
    position: absolute;
    bottom: 0px;
    font-size: 30px;
    color:#999;
    opacity: .8;
    top:4px;
    right: 0;
    }
    #addScore.show{
    opacity: .8;
    transition:all .5s ease;   -ms-transition:all .5s ease; -moz-transition:all .5s ease; -o-transition:all .5s ease; -webkit-transition:all .5s ease;

    }
    #addScore.hide{
    opacity: 0;
    transition:all .5s ease;   -ms-transition:all .5s ease; -moz-transition:all .5s ease; -o-transition:all .5s ease; -webkit-transition:all .5s ease;
    }

    canvas {
    background: #01bfae;
    cursor: pointer;
    -moz-user-select: none;
    -khtml-user-select: none;
    user-select: none;
    position: absolute;
    width: 450px;
    height: 450px;
    top:50%;
    left:0;
    margin-top: -200px;
    border: 1px solid #eee;
    z-index: 1;
    }

    #undo{
    position: relative;
    z-index: 990;
    }

    .cover{
    position: fixed;
    width: 100%;
    height: 100%;
    z-index: 999;
    opacity: 0.1;
    cursor: pointer;
    }

    .row0{
    top:10px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }
    .row1{
    top:120px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }
    .row2{
    top:230px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }
    .row3{
    top:340px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .cell0{
    left:10px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }
    .cell1{
    left:120px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }
    .cell2{
    left:230px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }
    .cell3{
    left:340px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    span{
    display: block;
    width: 100px;
    height: 100px;
    position: absolute;
    text-align: center;
    line-height: 100px;
    cursor: pointer;
    background: #fff;
    font-size: 43px;
    -moz-user-select: none;
    -khtml-user-select: none;
    user-select: none;
    }

    div{
    -moz-user-select: none;
    -khtml-user-select: none;
    user-select: none;

    }

    .num2{
    background: #fff;
    color:#777;
    font-size: 100px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    animation: myfirst .5s;
    -moz-animation: myfirst .5s;	/* Firefox */
    -webkit-animation: myfirst .5s;	/* Safari or Chrome or opera */
    }

    .num4{
    background: #fafafa;
    color: #e9b856;
    font-size: 100px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    animation: myfirst .5s;
    -moz-animation: myfirst .5s;	/* Firefox */
    -webkit-animation: myfirst .5s;	/* Safari or Chrome */
    }

    .num8{
    background: #f3f3f3;
    color:#f94e2f;
    font-size: 100px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    animation: myfirst .5s;
    }

    .num16{
    background: #F5EC00;
    color:#fff;
    font-size: 80px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    animation: myfirst .5s;
    }

    .num32{
    background: #fcc20e;
    color: #fdfdfd;
    font-size: 80px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .num64{
    background: #f94a3b;
    color:#fff;
    font-size: 80px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .num128{
    background: #222;
    color: #f94e2f;
    font-size: 52px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .num256{
    background: #d13100;
    color:#ffcc66;
    font-size: 52px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .num512{
    background: #fff300;
    color: #FB4E4E;
    font-size: 52px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .num1024{
    background: #6483b5;
    color: #f6f7ff;
    font-size: 52px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .num2048{
    background: #000000;
    color: #fff300;
    font-size: 52px;

    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    .num4096{
    background: #ff0099;
    color: #fff;
    font-size: 52px;
    transition:all .2s ease;   -ms-transition:all .2s ease; -moz-transition:all .2s ease; -o-transition:all .2s ease; -webkit-transition:all .2s ease;
    }

    @keyframes myfirst
    {
    0%{opacity: 0;transform:scale(0)}
    50% {opacity: .5;transform:scale(1.5)}
    100%{opacity: 1;transform:scale(1)}
    }

    @-moz-keyframes myfirst /* Firefox */
    {
    0%{opacity: 0;-moz-transform:scale(0)}
    50% {opacity: .5;-moz-transform:scale(1.5)}
    100%{opacity: 1;-moz-transform:scale(1)}
    }
    @-webkit-keyframes myfirst /* Safari or Chrome */
    {
    0%{opacity: 0;-webkit-transform:scale(0)}
    50% {opacity: .5;-webkit-transform:scale(1.5)}
    100%{opacity: 1;-webkit-transform:scale(1)}
    }
{% endblock %}
{% block game %}
<script type="text/javascript">
/**
* Breakout Game
* @author Joshua Sager
* @version 1.0
*/

window.onload = init;
var stage;
var bricks = new Array();
var colors = ['rgb(255,0,0)','rgb(0,255,0)','rgb(0,0,255)','rgb(255,255,0)']
var STAGE_WIDTH = 1000;
var STAGE_HEIGHT = 500;
var mouseX = 0;
var mouseY = 0;
var paddle = new Paddle(mouseX,400,100,20);
var loopInterval = setInterval(loop,1000/30);
var ball = new Ball(150,200,10);
var gameState;

function init(){
	gameState = "loading";
	// events
	window.onmousemove = function(event){onMouseMoveHandler(event);}
	initCanvas();
	drawBoard(20);
	gameState = "play";
}
function loop(){
	draw();
	hitTest();
}
/**
* Game State
*/
function checkGameState(){
	if(bricks.length==0){
		gameState = "win";
	}
	if(ball.y>STAGE_HEIGHT){
		gameState = "lose";
	}
	gameStateManager();
}
function gameStateManager(){
	switch(gameState){
		case "loading":
		break;

		case "play":
		break;

		case "win":
		pause();
		message("Winner");
		break;

		case "lose":
		pause();
		message("Game Over");
		break;
	}
}
function pause(){
	clearInterval(loopInterval);
}
function message(text){
	tag = document.createElement("h1");
	document.body.appendChild(tag);
	tag.innerHTML = text;
}
/**
* Drawing -- updates to graphics on screen
*/
function draw(){
	clearStage();
	paddle.update();
	updateBricks();
	ball.update();
	checkGameState();
}
/**
* Canvas
*/
function initCanvas(){
	canvas = document.getElementByID("gameCanvas");
	context = canvas.getContext('2d');
	canvas.width=STAGE_WIDTH;
	canvas.height=STAGE_HEIGHT;
	document.body.appendChild(canvas);
	stage = context;
}
/**
* Board this creates a board full of bricks
* @param num this is the number of bricks to create
*/
function drawBoard(num){
	for(var i=0; i<num; i++){
		drawBrick();
	}
}
/**
* Brick creation and removal
*/
function removeBrick(num){
	//stage.clearRect(bricks[num].x,bricks[num].y,bricks[num].width,bricks[num].height);
	bricks.splice(num,1);
}
function createBrick(x,y,width,height){
	var brick = new Brick(x,y,width,height);
	bricks.push(brick);
}
/**
* Hit Test
*/
function hitTest(){

	// ball hit testing agains the bricks
	for(var i=0; i<bricks.length; i++){
		if(((ball.x >bricks[i].x))
			&& ((ball.x)<bricks[i].x + bricks[i].width)
			&& (ball.y+ball.radius>bricks[i].y)
			&& (ball.y-ball.radius<bricks[i].y+bricks[i].height)
			){
			ball.hit();
			console.log("hit");
			removeBrick(i);
		}
	}

	// ball hit testing agains the paddle
	if((ball.x+ball.radius>paddle.x-paddle.width*.5)
		&&(ball.x-ball.radius<paddle.x+paddle.width*.5)
		&&(ball.y+ball.radius>paddle.y)
		&&(ball.y-ball.radius<paddle.y+paddle.height*.5)
		){
		console.log("paddle hit");
		ball.y=paddle.y-ball.radius;
		ball.hit();
		paddle.hit();
	}
}
/**
* Brick Drawing - draws a brick on the stage
*/
function drawBrick(){
	var xoffset = 50;
	var yoffset = 20;
	var STARTING_VALUE = 10;
	var x = STARTING_VALUE;
	var y = 0;
	// if first brick
	if(bricks.length!=0){
		x = bricks[bricks.length-1].x;
		y=bricks[bricks.length-1].y;

		// at the edge move brick down
		if(bricks[bricks.length-1].x>STAGE_WIDTH-xoffset){
			y+=yoffset;
			x=STARTING_VALUE;
		}else{
			x+=xoffset;
		}
	}
	createBrick(x,y,50,20);
}
function updateBricks(){
	for(var i=0; i<bricks.length; i++){
		bricks[i].update();
	}
}
/**
* Stage Methods
*/
function clearStage(){
	stage.clearRect(0,0,STAGE_WIDTH,STAGE_HEIGHT);
}
/**
* Mouse Methods
*/
function getMousePosition(evt){
	var e = new MouseEvent(evt);
	var rect = canvas.getBoundingClientRect();
	mouseX = e.x - rect.left;
	mouseY = e.y;
}
function onMouseMoveHandler(evt){
	getMousePosition(evt);
}
/**
* MouseEvent Class
* Creates a global reference to the mouse position via mouseX and mouseY
*/
function MouseEvent(e){
	e?this.e=e:this.e=window.event;
	e.pageX?this.x=e.pageX:this.x=e.clientX;
	e.pageY?this.y=e.pageY:this.y=e.clientY;
}
/**
* Brick Class
*/
function Brick(x,y,width,height){
	this.x = x;
	this.y = y;
	this.width = width;
	this.height = height;
	this.color = colors[parseInt(Math.random()*colors.length)]

	this.update=function(){
		stage.fillStyle = this.color;
		stage.fillRect(this.x,this.y,this.width,this.height);
	}
}
/**
* Paddle Class
*/
function Paddle(x,y,width,height){
	this.x = x;
	this.y = y;
	this.width = width;
	this.height = height;
	this.color = 'rgb(100,100,100)';

	this.update = function(){
		this.x = mouseX;
		stage.fillStyle = this.color;
		stage.fillRect(this.x-this.width*.5,this.y,this.width,this.height);
	}
	// Logic for ball x direction on paddle hit test with ball
	this.hit = function(){
		var dist = (this.x+this.width)-this.x;
		var total = ball.radius*2+paddle.width;
		var hitpoint = (ball.x+ball.radius)-(paddle.x-paddle.width*.5)
		var percent = hitpoint/total;

		// The paddle is subdivided into sections that influence the direction reversal
		if(percent>=.48 && percent <=.52){
			ball.vx=ball.vy*0;
		}else if(percent>=.45 && percent <=.57){
			ball.vx= ball.vy * .10;
		}else if(percent>=.43 && percent <=.55){
			ball.vx= ball.vy * -.10;
		}else if(percent >= .25 && percent <= .44){
			ball.vx= ball.vy * .25;
		}else if(percent >= .56 && percent <= .75){
			ball.vx= ball.vy * -.25;
		}else if(percent>=.10 && percent <=.24){
			ball.vx=ball.vy * .5;
		}else if(percent>=.76 && percent <=.90){
			ball.vx=ball.vy*-.5;
		}else if(percent>=.0 && percent <=.09){
			ball.vx=ball.vy*1;
		}else if(percent>=.91 && percent <-1){
			ball.vx=ball.vy*-1;
		}
	}
}
/**
* Ball Class
*/
function Ball(x,y,radius){
	this.x = x;
	this.y = y;
	this.vx = 0;
	this.vy = 10;

	this.radius = radius;
	this.color = 'rgb(100,100,100)';

	this.update = function(){
		this.y+=this.vy;
		this.x+=this.vx;
		this.bounds();
		stage.fillStyle = this.color;
		stage.beginPath();
		stage.arc(this.x,this.y,this.radius,0,Math.PI*2,true);
		stage.fill();
	}

	// keep the ball in bounds
	this.bounds = function(){
		if(ball.y-ball.radius<0){
			ball.y=0;
			this.hit();
		}
		if(ball.x>STAGE_WIDTH-ball.radius || ball.x<0){
			ball.vx*=-1;
		}
	}
	// reverse y direction
	this.hit = function(){
		this.vy*=-1;
	}
}
</script>
{% endblock %}